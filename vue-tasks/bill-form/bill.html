<!DOCTYPE html>
<html>
<head>
    <title>Vue Example</title>
    <link rel="stylesheet" href="bootstrap-5.3.2-dist/css/bootstrap.min.css" >
    <script src="bootstrap-5.3.2-dist/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
       .out{
        outline: none !important;
       }
    </style>
</head>
<body>

<div id="app" >


<div class="p-1"><button class="btn btn-primary"  v-on:click="show_add_form" >Add Bill</button></div>
<!-- Bills Table Structure Starting -->
<table class="table table-bordered table-hover">
    <thead>
        <tr>
            <th>#</th>
            <th>Name</th>
            <th>Mobile</th>
            <th>Amount</th>
            <th>.</th>
        </tr>
    </thead>
    <tbody>
        <tr v-for="bill,bi in bills" >
            <td>{{ bi+1 }}</td>
            <td>{{ bill['customer'] }}</td>
            <td>{{ bill['mobile'] }}</td>
            <td>{{ bill['amount'] }}</td>
            <td><input type="button" value="X" v-on:click="delete_bill(bi)"></td>
            <td><input type="button" value="Edit" v-on:click="edit_bill(bi)"></td>
        </tr>
    </tbody>
</table>
<!-- Bills Table Structure Ending -->

  <!-- Add Bill Popup Modal -->
  <div class="modal fade" id="addbillpopup" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Add Bill</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <table>
            <tr>
                <td>Customer</td>
                <td>Mobile</td>
                <td>Amount</td>
            </tr>
            <tr>
                <td><input type="text" class="out" v-on:keyup="validate_name()" v-bind:style="[validate_name()?{border:'1px blue solid'}:{border:'1px red solid'}]" v-model="add_record['customer']" ></td>
                <td><input type="text" class="out" v-on:keyup="validate_mobile()" v-bind:style="[validate_mobile()?{border:'1px blue solid'}:{border:'1px red solid'}]" v-model="add_record['mobile']" ></td>
                <td>{{ add_record['amount'] }}</td>
            </tr>
          </table>

          <table class="table table-striped table-bordered table-hover table-sm">
            <tr>
                <td>#</td>
                <td>Product</td>
                <td>Price</td>
                <td>Qty</td>
                <td>Total</td>
                <td>Tax</td>
                <td>Net</td>
                <td>.</td>
            </tr>
            <tr v-for="item,i in add_record['items']">
                <td>{{ i+1 }}</td>
                <td>
                    <select class="form-select form-select-sm" v-model="item['product_id']" v-on:change="product_selected(i)" >
                        <option v-for="p,pi in products" v-bind:value="pi" >{{ p['name'] }}</option>
                    </select>
                </td>
                <td align="right">{{ item['price'] }}</td>
                <td><input type="number" class="form-control form-control-sm" min="1" style="width:80px;" v-model="item['qty']" v-on:change="calc(i)" ></td>
                <td align="right">{{ item['total'] }}</td>
                <td align="right">{{ item['tax'] }}%</td>
                <td align="right">{{ item['net'] }}</td>
                <td><input type="button" value="X" v-on:click="remove_record(i)"></td>
                
            </tr>
          </table>
          <div><input type="button" value="+" v-on:click="add_item" ></div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" v-on:click="save_bill">Save Bill</button>
        </div>
      </div>
    </div>
  </div>
 <!-- End of Add Bill Pop up Modal -->

 <!-- Start of Edit Bill Pop Up-->

 <div
        
        id="editpopup"
        class="modal fade"
        
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
       
      >
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">Edit Bill</h1>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <table>
                <tr>
                  <td >Customer</td>
                  <td >Mobile</td>
                  
                  <td>Amount</td>
                </tr>
                <tr>
                  <td>
                    <input  type="text" v-model="edit_record['customer']" />
                  </td>
                  <td><input type="text" v-model="edit_record['mobile']" /></td>
                  <td>{{ edit_record['amount'] }}</td>
                </tr>
              </table>

              <table
                class="table table-striped table-bordered table-hover table-sm"
              >
                <tr>
                  <td>#</td>
                  <td>Product</td>
                  <td>Price</td>
                  <td>Qty</td>
                  <td>Total</td>
                  <td>Tax</td>
                  <td>Net</td>
                  <td>.</td>
                </tr>
                <tr v-for="item,i in edit_record['items']">
                  <td>{{ i+1 }}</td>
                  <td>
                    <select
                      class="form-select form-select-sm"
                      v-model="item['product_id']"
                      v-on:change="edit_product_selected(i)"
                    >
                      <option v-for="p,pi in products" v-bind:value="pi">
                        {{ p['name'] }}
                      </option>
                    </select>
                  </td>
                  <td align="right">{{ item['price'] }}</td>
                  <td>
                    <input
                      type="number"
                      class="form-control form-control-sm"
                      style="width: 80px"
                      v-model="item['qty']"
                      v-on:change="edit_calc(i)"
                    />
                  </td>
                  <td align="right">{{ item['total'] }}</td>
                  <td align="right">{{ item['tax'] }}%</td>
                  <td align="right">{{ item['net'] }}</td>
                  <td><input type="button" value="X" @click="product_rem(i)"/></td>
                </tr>
              </table>
              <div><input type="button" value="+" v-on:click="add_edit_item" /></div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Close
              </button>
              <button
                type="button"
                class="btn btn-primary"
                v-on:click="edit_save_change()"
              >
                Save changes
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>





 <!-- End of Edit Bill Pop Up-->
</div>

<script>
var app = Vue.createApp({
    data(){
        return {
            products: [
                {
                    "name": "Samsung TV",
                    "price": 45000,
                },
                {
                    "name": "LG AirConditioner",
                    "price": 35000,
                },
                {
                    "name": "Google Pixel Phone",
                    "price": 55000,
                },
                {
                    "name": "Philips Kettle",
                    "price": 350,
                },
                {
                    "name": "Maharaja Grinder",
                    "price": 600,
                },
                {
                    "name": "Lenova Laptop",
                    "price": 5000,
                },
                
            ],
            bills: [
                {
                    "customer": "Narayana",
                    "mobile": "9876543210",
                    "amount": 53926,
                    "items": [
                        {
                            "product_id": 1,
                            "price": 350,
                            "qty": 2,
                            "total": 700,
                            "tax": 18,
                            "net": 826
                        },
                        {
                            "product_id": 2,
                            "price": 45000,
                            "qty": 1,
                            "total": 45000,
                            "tax": 18,
                            "net": 52100
                        }
                    ]
                }
                
            ],
            add_record: {
                "customer": "",
                "mobile": "",
                "amount": 0,
                "items": [
                    {
                        "product_id":-1,
                        "price": 0,
                        "qty":0,
                        "total":0,
                        "tax":0,
                        "net":0,
                    }
                ]
            },
            edit_record :{
                "customer": "",
                "mobile": "",
                "amount": 0,
                "items": [
                    {
                        "product_id":-1,
                        "price": 0,
                        "qty":0,
                        "total":0,
                        "tax":0,
                        "net":0,
                    }
                ]
            },
            
        };
    },
    mounted(){
        
    },
    methods: {
            add_item: function(){
                this.add_record['items'].push({
                    "product_id":"",
                    "price": "",
                    "qty": 1,
                    "total": 0,
                    "tax": 0,
                    "net": 0
                });
            },
            add_edit_item: function(){
                this.edit_record['items'].push({
                    "product_id":"",
                    "price": "",
                    "qty": 1,
                    "total": 0,
                    "tax": 0,
                    "net": 0
                });
            },
            product_selected: function(vi){
                var p = this.products[ this.add_record['items'][vi]['product_id'] ]['price'];
                this.add_record['items'][vi]['price'] = p;
                this.calc(vi);
            },
            calc: function(vi){
                this.add_record['items'][vi]['total'] = this.add_record['items'][vi]['price']*this.add_record['items'][vi]['qty'];
                this.add_record['items'][vi]['tax'] = 18;
                this.add_record['items'][vi]['net'] = this.add_record['items'][vi]['total'] + (this.add_record['items'][vi]['total']*this.add_record['items'][vi]['tax']/100);
                this.calc_amount();
            },
            calc_amount: function(){
                var n = 0;
                for(var i=0;i<this.add_record['items'].length;i++){
                    n = n + this.add_record['items'][i]['net'];
                }
                this.add_record['amount'] = n;
            },
            show_add_form: function(i){
                pop = new bootstrap.Modal(document.getElementById('addbillpopup') );
                pop.show();
            
            },
            
            validate_name:function()
            {
                if( this.add_record['customer'].match(/^[a-z][a-z\ ]{2,}$/i) == null ){
                    console.log("no")
                    return false
                }else{
                    console.log("yes");
                        return true
                }
            },
            validate_mobile:function()
            {
                if( this.add_record['mobile'].match(/^[6-9][0-9]{9}$/i) == null ){
                    console.log("no")
                    return false
                }else{
                    console.log("yes");
                        return true
                }
            },
            edit_bill(i)

            {   this.edit_record['customer'] = this.bills[i]['customer']+'';
            this.edit_record['mobile'] = this.bills[i]['mobile']+'';
            //this.edit_record['custoer'] = this.bills[i]['amount']+'';
            this.edit_record['items'] = JSON.parse( JSON.stringify( this.bills[i]['items'] ) );
            edit_pop = new bootstrap.Modal(document.getElementById('editpopup') );
            edit_pop.show();
           this.edit_save_ind = i;
                
              
            },
            remove_record(vi){
                this.add_record['items'].splice(vi,1);
            },
            delete_bill(billno){
                this.bills.splice(billno,1);
            },
            edit_product_selected: function(vi){
                var p = this.products[ this.edit_items[vi]['product_id'] ]['price'];
                this.edit_items[vi]['price'] = p;
                this.edit_calc(vi);
            },
            save_bill: function(){
                if(this.validate_name() && this.validate_mobile())
                {
                        this.bills.push( JSON.parse(JSON.stringify(this.add_record)) );
                        this.add_record = {
                        "customer": "",
                        "mobile": "",
                        "amount": 0,
                        "items": [
                            {
                                "product_id":-1,
                                "price": 0,
                                "qty":0,
                                "total":0,
                                "tax":0,
                                "net":0,
                            }
                        ]
                        };
                    //pop = new bootstrap.Modal(document.getElementById('addbillpopup') );
                    pop.hide();
                }
                else
                {
                        console.log("Invalid Name");
                }
            },
            edit_product_selected: function(vi){
                var p = this.products[ this.edit_record['items'][vi]['product_id'] ]['price'];
                this.edit_record['items'][vi]['price'] = p;
                
            },
            edit_calc: function(vi){
                this.edit_record['items'][vi]['total'] = Number(this.edit_record['items'][vi]['price'])*Number(this.edit_record['items'][vi]['qty']);
                this.edit_record['items'][vi]['tax'] = 18;
                this.edit_record['items'][vi]['net'] =  this.edit_record['items'][vi]['total'] + (this.edit_record['items'][vi]['total']*this.edit_record['items'][vi]['tax']/100);
                this.edit_calc_amount();
            },
            edit_calc_amount: function(){
                var n = 0;
                for(var i=0;i<this.edit_record['items'].length;i++){
                    n = n + this.edit_record['items'][i]['net'];
                }
                this.edit_record['amount'] =n;
            },
            edit_save_change(){
              let i = this.edit_save_ind;
              this.bills[i]['customer']=this.edit_record['customer']+'',
              this.bills[i]['mobile'] = this.edit_record['mobile']+'',
              this.bills[i]['amount'] = this.edit_record['amount']+'',
              this.bills[i]['items']= JSON.parse( JSON.stringify( this.edit_record['items'] ) );
              edit_pop.hide();

            }
    }
}).mount("#app");
</script>

</body>
</html>